{"version":3,"file":"main.js","sourceRoot":"","sources":["main.ts"],"names":[],"mappings":"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","sourcesContent":["//ファイル1行ずつ読み込み\nimport * as readline from 'readline';\nimport * as fs from 'fs';\n\ninterface objstr{\n  str : string;\n};\n\nconst main = async () => {\n    console.log('----- start ------');\n    await readFile();\n    console.log('----- end -----');\n\n    //JavaScriptで呼び出し先のメソッドで引数の内容を更新したい場合はオブジェクト型を渡す必要がある\n    let objstr : objstr= {str:'xyz'};\n    console.log('1.piyo:' + objstr.str);\n    test(objstr);\n    console.log('2.piyo:' + objstr.str);\n\n    //let hoge ='ｱｲｳ｡「」abcあいう𠮟';\n    let hoge ='｡a「あいう」𠮟';;\n    let foo : string = \"\";\n    for(let i:number = 0; i <= hoge.length- 1; i++){\n      console.log('\\\\u' + ('0000' + hoge[i].charCodeAt(0).toString(16)).slice(-4));\n      foo += '\\\\u' + ('0000' + hoge[i].charCodeAt(0).toString(16)).slice(-4);\n    }\n\n\n    let objstr2 : objstr = {str:''};\n    if(chkStrLen(hoge, 10, objstr2) === false){\n      console.log('chk ng:' + objstr2.str);\n    };\n\n    //let foo = '\\\\u0061';\n    let  len : number = 0;\n    //let flg : boolean = false;\n    for (let i : number = 0; i < foo.length; i++) {\n      if (foo[i] === '\\\\') {\n          console.log(foo.substr(i + 2, 4));\n          if(foo.substr(i + 2, 4) >= \"0000\" && foo.substr(i + 2 , 4) <= \"007f\"){\n            len++;\n          }else if(foo.substr(i + 2, 4) >= \"ff61\" && foo.substr(i + 2 , 4) <= \"ff9f\"){\n            len++;\n          }else{\n            len += 2;\n          }\n          i += 5;\n      }\n    }\n    console.log('len:' + len);\n\n\n    let result = unicodeUnescape('\\\\u0061\\\\u3042\\\\u3044\\\\u3046\\\\u3048\\\\u304a\\\\ud842\\\\udf9f');\n    console.log(result);\n}\n\n\nconst chkStrLen = (chkStr:string, chkLen:number, refStr:objstr) : Boolean => {\n\n  let utf16Str:string = '';\n  let wrStr:string = '';\n  let len:number = 0;\n\n  for(let i:number = 0; i <= chkStr.length - 1; i++){\n    utf16Str += '\\\\u' + ('0000' + chkStr[i].charCodeAt(0).toString(16)).slice(-4);\n  }\n\n  for (let i:number = 0; i < utf16Str.length; i++) {\n    if (utf16Str[i] === '\\\\') {\n        if(utf16Str.substr(i + 2, 4) >= \"0000\" && utf16Str.substr(i + 2 , 4) <= \"007f\"){\n          len++;\n        }else if(utf16Str.substr(i + 2, 4) >= \"ff61\" && utf16Str.substr(i + 2 , 4) <= \"ff9f\"){\n          len++;\n        }else{\n          len += 2;\n        }\n\n        if(len <= chkLen){\n          //console.log(utf16Str.substr(i, 6));\n          wrStr += unicodeUnescape(utf16Str.substr(i, 6));\n        }\n\n        i += 5;\n    }\n  }\n\n  if(len > chkLen){\n    //ng\n    console.log(wrStr);\n    refStr.str = 'abc';\n    //refStr.str = wrStr;\n    return false;\n  }\n  //ok\n  return true;\n};\n\n\n\n\n\n\n\nconst readFile = () : Promise<void> => {\n    let filePath = './test.txt';\n    let stream = fs.createReadStream(filePath, 'utf8');\n    let reader = readline.createInterface({input: stream});\n\n    return new Promise((resolve, reject) =>{\n          reader.on('line', (line) => {\n              console.log(line + \":\" + charCount(line));\n          })\n          .on('close', () => {\n              console.log('read end');\n              resolve();\n          });\n    });\n};\n\n\n\nconst unicodeUnescape = (str) => {\n    let result = '';\n    let strs = str.match(/\\\\u.{4}/ig);\n    if (!strs) return '';\n    for (var i = 0, len = strs.length; i < len; i++) {\n        result += String.fromCharCode(strs[i].replace('\\\\u', '0x'));\n    }\n\n\n    return result;\n};\n\nconst test = (objStr:objstr) => {\n    objStr.str = 'abc';\n};\n\n\n//let ait = reader[Symbol.asyncIterator]();\n//(await ait.next()).value)\n\n\n//reader.on('line', (data) => {\n//    console.log(data + \":\" + charCount(data));\n//});\n\n//const fileRead = (stream) : Promise<void > => {\n//  return new Promise((resolve, reject) =>{\n//      reader.on('line', (line) => {\n//          console.log(line + \":\" + charCount(line));\n//      })\n//      .on('close', () => {\n//          console.log('read end');\n//      });\n//  });\n//};\n\n\nconst charCount = (str : string) : Number => {\n  let len = 0;\n  //特定の文字を16進数のエスケープシーケンスで置き換えた新しい文字列に置き換える\n  str = escape(str);\n\n  for (let i : number = 0; i < str.length; i++,len++) {\n    if (str.charAt(i) == '%') {\n      //UTF16フォーマットされた文字列(%uFFFF)の1文字目\n      if (str.charAt(++i) == 'u') {\n        //UTF16フォーマットされた文字列(%uFFFF)の2文字目\n        i += 3;\n        len++;\n      }\n      i++;\n    }\n  }\n  return len;\n};\n\nmain();"]}